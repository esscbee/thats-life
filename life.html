<html>
	<head>
		<title>That's Life</title>
		<style>
			body { margin: 0;
					background-color: #f0f0f0;
			}
			canvas { width: 100%; height: 100% }
		</style>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap-theme.min.css">
	</head>
	<body>
		<p class="text-center">
			<button type="button" class="btn btn-default" aria-label="Left Align" onclick="doStep()">
			  <span class="glyphicon glyphicon-step-forward" aria-hidden="true"></span>
			</button>
			<button type="button" class="btn btn-default" aria-label="Left Align" onclick="play()">
			  <span id="play-button" class="glyphicon glyphicon-play" aria-hidden="true"></span>
			</button>
			<button type="button" class="btn btn-default" aria-label="Left Align" onclick="editNavToggle()">
			  <span id="edit-nav-button" class="glyphicon glyphicon-screenshot" aria-hidden="true"></span>
			</button>
			<button type="button" class="btn btn-default" aria-label="Left Align" onclick="resetBoardModel(true)">
			  <span id="edit-nav-button" class="glyphicon glyphicon-trash" aria-hidden="true"></span>
			</button>
			<button type="button" class="btn btn-default" aria-label="Left Align" onclick="resetBoardModel(false)">
			  <span id="edit-nav-button" class="glyphicon glyphicon-remove" aria-hidden="true"></span>
			</button>
			<!--
			<button type="button" class="btn btn-default" aria-label="Left Align" onclick="saveBoard()">
			  <span id="edit-nav-button" class="glyphicon glyphicon-save" aria-hidden="true"></span>
			</button>
			<button type="button" class="btn btn-default" aria-label="Left Align" onclick="openBoard()">
			  <span id="edit-nav-button" class="glyphicon glyphicon-open" aria-hidden="true"></span>
			</button>
			<button type="button" class="btn btn-default" aria-label="Left Align" onclick="compressBoard()">
			  <span id="edit-nav-button" class="glyphicon glyphicon-compressed" aria-hidden="true"></span>
			</button>
			-->
		</p>
		<p id='status-field' class="text-center">Status</p>
		<script src="js/three.min.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="node_modules/three/examples/js/libs/stats.min.js"></script>
		<script src="LIFE.js"></script>
		<script src="ThreeDBoard.js"></script>
		<script src="BoardModel.js"></script>
		<script>
			var BOARD_SIZE_Y = 200;
			var BOARD_SIZE_X = 200;
			var board;
			var boardModel;

			var render = function() {
				if(board && boardModel)
					board.render();
				// console.log('render!');
			}

			function resetBoardModel(reinit) {
				if(board) {
					var d = board;
					board = undefined;
					d.dispose();
				}
				if(boardModel) {
					var d = boardModel;
					boardModel = undefined;
					d.dispose();
				}
				if(reinit) {
					board = new LIFE.ThreeDBoard(BOARD_SIZE_X, BOARD_SIZE_Y, window, document);
					boardModel = new LIFE.BoardModel(BOARD_SIZE_X, BOARD_SIZE_Y, board, updateStatus);
					play(false);
					board.animate();
					boardModel.updateStatus();
				}
			}
			resetBoardModel(true);
			var dj = Math.floor(BOARD_SIZE_X / 5);
			var startJ = Math.floor((BOARD_SIZE_X - dj) / 2);
			var theI = Math.floor(BOARD_SIZE_Y / 2);
			for(var j = startJ; j < (startJ + dj); j++) {
				boardModel.setCell(j, theI, ALIVE, false);
			}
			boardModel.updateStatus();

			// window.onresize = function(event) {
			// 	//camera.aspect = window.innerWidth / window.innerHeight;
			// 	//camera.updateProjectionMatrix();
			// 	renderer.setSize( window.innerWidth, window.innerHeight );
			// 	console.log('resize: ' + window.innerWidth + ', ' + window.innerHeight);
			// }
			function updateStatus(contents, growth) {
				var color = 'black';
				if(growth > 0)
					color = 'green';
				else if(growth < 0)
					color = 'red';

				if(contents == undefined)
					contents = '';
				var status = document.getElementById('status-field');
				status.innerHTML = contents;
				status.style.color = color;
			}
			function play(state) {
				if(!board || !boardModel)
					return;
				var playButton = document.getElementById("play-button");
				var newState = !boardModel.playing;
				if(state != undefined)
					newState = state;
				boardModel.play(window, newState);
				if(!newState) {
					playButton.className = 'glyphicon glyphicon-play';
				} else {
					playButton.className = 'glyphicon glyphicon-pause';
				}
				editNavToggle(board.playing); // set editing mode
			}
			function doStep() {
				if(!board || !boardModel)
					return;
				if(boardModel.playing) {
					play(false);
					return;
				}
				boardModel.generate(true);
			}
			function editNavToggle(setting) {
				if(!board)
					return;
				var navEditButton = document.getElementById("edit-nav-button");
				if(!board.navEditToggle(setting)) {
					navEditButton.className = 'glyphicon glyphicon-screenshot';
				} else {
					navEditButton.className = 'glyphicon glyphicon-pencil';
				}
			}
			function compressBoard() {
				if(!boardModel)
					return;
				boardModel.compressBoard();
			}
		</script>
	</body>
</html>